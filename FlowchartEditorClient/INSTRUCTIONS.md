# Инструкция по запуску и тестированию Android клиента

## Настройка подключения к серверу

### Для Android Emulator (рекомендуется для разработки)

По умолчанию в `build.gradle` настроен адрес для эмулятора:
```
http://10.0.2.2:5143/
```

**10.0.2.2** - это специальный IP адрес, который эмулятор Android использует для обращения к localhost вашего компьютера.

### Для реального Android устройства

1. Узнайте IP адрес вашего компьютера в локальной сети:
   - Windows: `ipconfig` (ищите IPv4 адрес)
   - Linux/Mac: `ifconfig` или `ip addr`
   
2. Измените `BASE_URL` в `app/build.gradle`:
   ```gradle
   buildConfigField "String", "BASE_URL", "\"http://192.168.1.100:5143/\""
   ```
   (замените на ваш IP адрес)

3. Убедитесь, что телефон и компьютер в одной Wi-Fi сети

## Запуск сервера

1. Перейдите в папку сервера:
   ```bash
   cd DAoSS-backend_wip
   ```

2. Убедитесь, что PostgreSQL запущен и настроен (или используйте переменные окружения)

3. Запустите сервер:
   ```bash
   dotnet run --project src/WebApi/DAOSS.WebApi.csproj
   ```

4. Сервер запустится на:
   - HTTP: `http://localhost:5143`
   - HTTPS: `https://localhost:7143`

5. Проверьте работу сервера:
   - Откройте браузер: `http://localhost:5143`
   - Должно появиться: "Бэкенд сервиса запущен"
   - Swagger UI: `http://localhost:5143/swagger` (в режиме Development)

## Запуск Android приложения

1. Откройте проект в Android Studio

2. Подключите устройство или запустите эмулятор

3. Нажмите Run (Shift+F10)

4. Приложение установится и запустится

## Проверка работы

### 1. Регистрация пользователя
- Откройте приложение
- Нажмите "Register" (или перейдите на экран регистрации)
- Заполните все поля:
  - Name
  - Login
  - Email
  - Password
- Нажмите "Register"
- Токен должен сохраниться автоматически

### 2. Вход в систему
- Если вы уже зарегистрированы, введите Login и Password
- Нажмите "Login"
- Должен произойти переход на экран списка проектов

### 3. Просмотр проектов
- После входа должен загрузиться список проектов (может быть пустым)
- Если ошибка - проверьте логи в Logcat

### 4. Создание проекта
- Нажмите кнопку "+" (FAB)
- Введите название проекта
- Введите описание (опционально)
- Нажмите "Create"
- Проект должен появиться в списке

## Отладка

### Просмотр логов

1. В Android Studio откройте вкладку **Logcat**
2. Фильтруйте по тегу вашего приложения
3. Ищите ошибки сети или API

### Проверка HTTP запросов

В `ApiClient` включен `HttpLoggingInterceptor`, который выводит все HTTP запросы и ответы в Logcat. Ищите теги:
- `OkHttp` - HTTP запросы
- `Retrofit` - API вызовы

### Типичные проблемы

1. **"Network error" или "Failed to connect"**
   - Проверьте, что сервер запущен
   - Проверьте правильность BASE_URL
   - Для эмулятора используйте `10.0.2.2`
   - Для реального устройства используйте IP компьютера

2. **"401 Unauthorized"**
   - Проверьте, что токен сохраняется после регистрации/входа
   - Проверьте формат токена в `AuthInterceptor`

3. **"400 Bad Request"**
   - Проверьте формат данных в запросах
   - Проверьте обязательные поля (ownerId, description и т.д.)

4. **"Failed to get user info"**
   - Убедитесь, что токен валидный
   - Проверьте, что эндпоинт `/api/auth/me` доступен

### Проверка через Swagger

1. Откройте `http://localhost:5143/swagger`
2. Попробуйте выполнить запросы вручную
3. Сравните с тем, что отправляет Android клиент

## Настройка для продакшена

Для продакшена измените `BASE_URL` в `build.gradle`:

```gradle
buildTypes {
    release {
        minifyEnabled false
        proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        buildConfigField "String", "BASE_URL", "\"https://your-production-server.com/\""
    }
}
```

## Дополнительные настройки

### Использование HTTPS localhost

Если нужно использовать HTTPS (`https://localhost:7143`), нужно:

1. Добавить в `AndroidManifest.xml`:
   ```xml
   <application
       android:usesCleartextTraffic="true"
       ...>
   ```

2. Для доверия к self-signed сертификату нужно настроить Network Security Config (сложнее, обычно не требуется для разработки)

Рекомендуется использовать HTTP для разработки на localhost.

